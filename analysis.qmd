---
title: Analysis
description: An Exploratory Analysis Delving into the Complex Relationship Between Race, Socioeconomic, and Post-Grad Earnings 
execute: 
  echo: false
toc: true
draft: false
---

![](images/analysis-pic.jpg)

## Introduction
This analysis is motivated by the need to unravel how racial disparity adversely impacts different groups across the United States. Continuing to question societal norms and reveal how inequities persist in society is crucial towards challenging prejudice and racism.

![](images/analysis-pic.jpg)


## Motivation Behind Data Analysis
#### Variables and Relationships of Interest

This analysis aims to investigate the relationship between mean post-graduation earnings, a post-college academic indicator of success, with student characteristics of race and socioeconomic status. By identifying if there exists a correlation between certain student characteristics and pre-college factors and post-college success outcomes, the analysis aims to provide insight on whether financial success is related to student background. The key questions are as followed:

*The following variables from the dataset will be the focal point in the analysis:*

Every school has varying student populations and proportion students from each race category. To ensure the consistency of the data, this analysis utilizes weighted average earnings:

- Num_White_Students: Number of White students at the institution
- Num_Black_Students: Number of Black students at the institution
- Num_Hispanic_Students: Number of Hispanic students at the institution
- Num_Asian_Students: Number of Asian students in at the institution
- Social_Econ_Div: [For a more detailed explanation, see `Big Picture` page] Proportion undergraduate students who received Pell Grants, displaying a metric for low income student population


```{r}
suppressWarnings(suppressMessages(library(tidyverse)))
suppressWarnings(suppressMessages(library(ggplot2)))
suppressWarnings(suppressMessages(library(readr)))
suppressWarnings(suppressMessages(library(dplyr)))
suppressWarnings(suppressMessages(library(scales)))
suppressWarnings(suppressMessages(library(patchwork)))

# Load the dataset
education_cohort_data_cleaned <- read_rds("dataset/education_cohort_data_cleaned.rds")

education_cohort_data_cleaned <- education_cohort_data_cleaned %>%
  mutate(
    Num_White_Students = Pop * Perc_Undergrad_White, 
    Num_Black_Students = Pop * Perc_Undergrad_Black,
    Num_Hispanic_Students = Pop * Perc_Undergrad_Hispanic, 
    Num_Asian_Students = Pop * Perc_Undergrad_Asian,
    Social_Econ_Div = 1-Socioeconomic_Div
  )
```

### Key Questions

### 1. Do Historically Black Colleges and Universities (HBCUs) have significantly lower average post-graduation earnings compared to non-HBCUs?
```{r}
# Research Question 1: Do HBCUs have significantly lower average post-graduation earnings compared to non-HBCUs?
# Subset data for HBCU and non-HBCU
hbcu_earnings <- education_cohort_data_cleaned |> filter(Historically_Black == 1) %>% 
  select(Mean_earnings_After_6_Years, Mean_earnings_After_7_Years, 
         Mean_earnings_After_8_Years, Mean_earnings_After_9_Years, 
         Mean_earnings_After_10_Years) |> 
  rowMeans(na.rm = TRUE)

non_hbcu_earnings <- education_cohort_data_cleaned %>% filter(Historically_Black == 0) %>% 
  select(Mean_earnings_After_6_Years, Mean_earnings_After_7_Years, 
         Mean_earnings_After_8_Years, Mean_earnings_After_9_Years, 
         Mean_earnings_After_10_Years) %>% 
  rowMeans(na.rm = TRUE)

# Perform t-test
t_test_result <- t.test(hbcu_earnings, non_hbcu_earnings)

# Plot the comparison of earnings
hbcu_status <- c(rep('HBCU', length(hbcu_earnings)), rep('Non-HBCU', length(non_hbcu_earnings)))
earnings <- c(hbcu_earnings, non_hbcu_earnings)
earnings_df <- data.frame(hbcu_status, earnings)

# Update the boxplot to add color
ggplot(earnings_df, aes(x = hbcu_status, y = earnings, fill = hbcu_status)) +
  geom_boxplot() +
  scale_fill_manual(values = c("HBCU" = "lightblue", "Non-HBCU" = "orange")) +
  labs(title = 'Comparison of Average Earnings (HBCU vs Non-HBCU)', 
       x = 'Institution Type', 
       y = 'Average Earnings (USD)') +
  theme_minimal()

print(t_test_result)
```
The Welch Two Sample t-test results indicate a statistically significant difference in post-graduation earnings between HBCU and non-HBCU graduates (p-value = 5.09e-08). The mean earnings for HBCU graduates ($30,646.67) are significantly lower than those of non-HBCU graduates ($46,492.66). The 95% confidence interval for the difference in means ranges from -18,530.66 to -13,161.34, confirming that HBCU graduates earn considerably less on average. This result strongly supports the conclusion that there is a substantial earnings gap between the two groups.



### 2. Is there a significant difference in post-graduation earnings between racial groups across U.S. colleges?
```{r}
# Reshape data for faceting
education_cohort_data_long <- education_cohort_data_cleaned %>%
  select(Avg_Mean_earning, 
         Num_White_Students, 
         Num_Black_Students, 
         Num_Hispanic_Students, 
         Num_Asian_Students) %>%
  pivot_longer(
    cols = c(Num_White_Students, Num_Black_Students, Num_Hispanic_Students, Num_Asian_Students),
    names_to = "Race",
    values_to = "Num_Students"
  )

# Define improved custom colors for each race
race_colors <- c(
  "Num_White_Students" = "#1f78b4",   # Soft blue
  "Num_Black_Students" = "#33a02c",   # Soft green
  "Num_Hispanic_Students" = "#ff7f00", # Warm orange
  "Num_Asian_Students" = "#6a3d9a"    # Muted purple
)

# Generate combined scatterplot with red best-fit lines
ggplot(education_cohort_data_long, aes(x = Num_Students, y = Avg_Mean_earning, color = Race)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "red") +  # Red best-fit line
  facet_wrap(~ Race, scales = "free_x", labeller = as_labeller(c(
    Num_White_Students = "White Students",
    Num_Black_Students = "Black Students",
    Num_Hispanic_Students = "Hispanic Students",
    Num_Asian_Students = "Asian Students"
  ))) +
  scale_color_manual(values = race_colors) +
  labs(
    title = "Scatterplots of Race-Specific Student Counts vs. Average Mean Earnings",
    x = "Number of Students",
    y = "Average Mean Earnings",
    color = "Race"
  ) +
  theme_minimal()
```
The scatterplots illustrate the relationship between the number of students from specific racial groups and average post-graduation earnings across U.S. colleges. Key observations suggest that the relationship between racial composition and earnings differs across groups:

	1.	Asian Students: There is a positive correlation between the number of Asian students and average earnings. Colleges with more Asian students tend to have higher average post-graduation earnings, suggesting a potential advantage for this group.
	2.	Black Students: The plot shows no significant correlation between the number of Black students and average earnings. Regardless of student numbers, average earnings remain relatively stagnant, indicating limited economic mobility for Black graduates.
	3.	Hispanic Students: A slight positive trend is observed, but it is less pronounced compared to Asian students. This indicates that an increase in Hispanic representation has a limited but slightly positive impact on earnings.
	4.	White Students: There is a mild positive correlation between the number of White students and average earnings, though the trend is weaker than for Asian students.

These plots highlight disparities in post-graduation earnings across racial groups, with Asian and White students exhibiting more favorable trends, while Black and Hispanic students show weaker or stagnant earnings growth. Statistical tests (e.g., ANOVA) would be needed to confirm the significance of these differences.

# Linear Model of Racial disparities in post-graduation earnings 
```{r}
education_cohort_data_cleaned <- read_rds("dataset/education_cohort_data_cleaned.rds")

education_cohort_data_cleaned <- education_cohort_data_cleaned %>%
  mutate(
    Num_White_Students = Pop * Perc_Undergrad_White, 
    Num_Black_Students = Pop * Perc_Undergrad_Black,
    Num_Hispanic_Students = Pop * Perc_Undergrad_Hispanic, 
    Num_Asian_Students = Pop * Perc_Undergrad_Asian,
    Social_Econ_Div = 1-Socioeconomic_Div
  )

model_race <- lm(
  Avg_Mean_earning ~ Num_White_Students + 
    Num_Black_Students + 
    Num_Hispanic_Students + 
    Num_Asian_Students,
  data = education_cohort_data_cleaned
)

summary_model <- summary(model_race)


# Print coefficients and statistics
cat("Coefficients, Standard Errors and p-values:\n")
print(summary_model$coefficients[, c("Estimate", "Std. Error", "Pr(>|t|)")])
cat("\nR-squared:\n")
cat("Multiple R-squared:", summary_model$r.squared, "\n")
cat("Adjusted R-squared:", summary_model$adj.r.squared, "\n")
cat("\nF-statistic and p-value:\n")
cat("F-statistic:", summary_model$fstatistic[1], "on", summary_model$fstatistic[2], "and", summary_model$fstatistic[3], "DF, p-value:", 
    pf(summary_model$fstatistic[1], summary_model$fstatistic[2], summary_model$fstatistic[3], lower.tail = FALSE), "\n")
```
### Model Overview: 
For this model, every race variable from the cleaned dataset is being included in order to build a simple linear regression. It shows what happens to median earnings when the racial composition changes, assuming no other factors included.

### Model Findings: 
Num_White_Students: A one White student increase in a school is associated with a $0.168 increase in the expected value of mean earnings of students who have graduated but it is not significant (p = 0.947).

Num_Black_Students: A one Black student increase in a school is associated with a $0.948 decrease in the expected value of mean earnings of students who have graduated and it is significant (p = 0.007).

Num_Asian_Students: A one Asian student increase in a school is associated with a $2.282 increase in the expected value of mean earnings of students who have graduated and it is highly significant (p < 0.001).

Num_Hispanic_Students: A one Hispanic student increase in a school is associated with a $0.394 decrease in the expected value of mean earnings of students who have graduated and it is significant (p = 0.0147).

The adjusted R-square value of 0.1328 shows that approximately 13.28% of the variation in median earnings within schools is explained by the model indicating the model has only a small portion of explanatory power.


The finding from this regression model show significant disparities in mean earnings after graduating based on the racial composition of undergraduate students. Specifically, schools with higher percentages of Black students are associated with significantly lower earnings, which suggests systemic challenges that may reflect inequalities such as economic barriers. On the other hand, a higher proportion of Asian students is strongly correlate to increased earnings, indicating schools with a higher proportion of Asian students are often prestigious institutions (eg: universities with strong STEM programs). However, the low number of adjusted R-square, which is a sign of omitted variable bias. The model could be improved by adding some control variables like economic factors and institution factors. Doing so will produce more realistic results and provide better understanding into what affects median earnings.

# Residual Plots for The First lm Model
  Residual Plots help to determine whether a linear model is appropriate in modeling
```{r}
education_cohort_data_cleaned <- education_cohort_data_cleaned %>%
  mutate(
    Residuals = resid(model_race),
    Fitted_Values = fitted(model_race)
  )

# residual for Black
plot_black <- ggplot(education_cohort_data_cleaned, aes(x = Perc_Undergrad_Black, y = Residuals)) +
  geom_point(alpha = 0.6) +
  geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
  labs(
    title = "Residuals vs Black",
    x = "Percentage of Black Students",
    y = "Residuals"
  ) +
  theme_minimal()

#For Asian
plot_asian <-ggplot(education_cohort_data_cleaned, aes(x = Perc_Undergrad_Asian, y = Residuals)) +
  geom_point(alpha = 0.6) +
  geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
  labs(
    title = "Residuals vs Asian",
    x = "Percentage of Asian Students",
    y = "Residuals"
  ) +
  theme_minimal()

# residual for White
plot_white <-ggplot(education_cohort_data_cleaned, aes(x = Perc_Undergrad_White, y = Residuals)) +
  geom_point(alpha = 0.6) +
  geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
  labs(
    title = "Residuals vs White",
    x = "Percentage of White Students",
    y = "Residuals"
  ) +
  theme_minimal()

# residual for Hispanic
plot_hispanic <-ggplot(education_cohort_data_cleaned, aes(x = Perc_Undergrad_Hispanic, y = Residuals)) +
  geom_point(alpha = 0.6) +
  geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
  labs(
    title = "Residuals vs Hispanic",
    x = "Percentage of Hispanic Students",
    y = "Residuals"
  ) +
  theme_minimal()

combined_plot <- plot_asian + plot_black + plot_hispanic + plot_white + 
                 plot_layout(ncol = 2, nrow = 2)

combined_plot
```
Out of these four residual plots, the plot for Black students is most noticeable. The plot for White students shows residuals are fairly spread. Plot for Hispanic and Asian students also have some spreads but not as severe as the plot for Black students shows. The plot for Black Students shows a strong funnel shape, where the residuals show much greater variability as the percentage of Black students increases. This pattern indicate heteroskedasticity, where the variance of residuals is not constant across the predictor variable. It can be concluded that For schools with a higher percentage of Black students, The model’s predictions is less accurate



# Linear Model of Racial Disparities in Post-graduation Earnings After Adding A Socioeconomic factor
Model Overview: Like what is mentioned in the previous model, adding some other control variables such as socioeconomic factors might reduce the omitted variable bias and therefore, improve the model fit. In this model, Socioeconomic_Div are added. 
```{r}
model_race <- lm(
  Avg_Mean_earning ~ Num_White_Students + 
    Num_Black_Students + 
    Num_Hispanic_Students + 
    Num_Asian_Students +
    Social_Econ_Div,
  data = education_cohort_data_cleaned
)
summary_model <- summary(model_race)

# Print coefficients and statistics
cat("Coefficients, Standard Errors and p-values:\n")
print(summary_model$coefficients[, c("Estimate", "Std. Error", "Pr(>|t|)")])
cat("\nR-squared:\n")
cat("Multiple R-squared:", summary_model$r.squared, "\n")
cat("Adjusted R-squared:", summary_model$adj.r.squared, "\n")
cat("\nF-statistic and p-value:\n")
cat("F-statistic:", summary_model$fstatistic[1], "on", summary_model$fstatistic[2], "and", summary_model$fstatistic[3], "DF, p-value:", 
    pf(summary_model$fstatistic[1], summary_model$fstatistic[2], summary_model$fstatistic[3], lower.tail = FALSE), "\n")
```
### Model Findings
The extremely small p-value for Social_Econ_Div (1.04e-46) indicates that it is highly statistically significant, suggesting a very strong relationship between socioeconomic diversity and average mean earnings. Its inclusion substantially increases the Multiple R-squared value, from approximately 0.14 to 0.42. This indicates that the model’s ability to explain the variability in average earnings has improved significantly. The increase in R-squared confirms that Social_Econ_Div is a key driver of earnings and helps the model explain the data more accurately.

However, Adding Social_Econ_Div to the linear regression model significantly changes the results because it is a highly influential variable that explains a large portion of the variation in the dependent variable Avg_Mean_earning according to the increasing R-squared. When Social_Econ_Div is introduced, it directly accounts for the socioeconomic diversity of schools, which strongly correlates with average earnings. This new predictor changes the “explanatory responsibility” of the other variables in the model, causing their coefficients to shift significantly.

```{r}
# Load the dataset
education_data <- read_rds("dataset/education_cohort_data_cleaned.rds")

# Plot the data with a best-fit line
education_data |>
  mutate(Social_Econ_Div = 1 - Socioeconomic_Div) |>
  select(Social_Econ_Div, Socioeconomic_Div, Avg_Mean_earning) |>
  ggplot(aes(x = Social_Econ_Div, y = Avg_Mean_earning)) + 
  geom_point(alpha = 0.7) +  # Scatter plot with transparency
  geom_smooth(method = "lm", color = "blue", se = TRUE) +  # Best-fit line with confidence interval
  labs(
    title = "Socioeconomic Diversity vs. Average Mean Earnings",
    x = "Socioeconomic Diversity",
    y = "Average Mean Earnings"
  ) +
  theme_minimal()
```
It is shown that Social economic diversity is positively related average earnings, which means that schools that have more high income students tend to have higher earnings after graduating. Then logically, adding this variable to the model with still remain the same pattern, but this variable Social_Econ_Div completely shift the other race variable. A major reason for this shift is multicollinearity, which occurs when predictors in a regression model are correlated with each other. Before adding Social_Econ_Div, the variables like Num_White_Students, Num_Black_Students, and others were indirectly capturing some of the effects of socioeconomic diversity because it was not explicitly included. When Social_Econ_Div is introduced, it absorbs much of the explanatory power that previously appeared to belong to the other predictors. This redistribution results in dramatic changes to their coefficients, including changes in magnitude and, in some cases, sign. 




# Limitations:
One limitation of this model is the issue of multicollinearity, as evidenced by the significant coefficient shifts after adding the socioeconomic diversity variable (Social_Econ_Div). This suggests that predictors like racial composition were previously capturing part of the socioeconomic effect, making it difficult to disentangle their individual contributions. Multicollinearity reduces the reliability of the coefficients, which can lead to unstable interpretations regarding the precise effect of each variable.

Another limitation is the simplicity of the model in its current form. While adding Social_Econ_Div improved the explanatory power (R-squared increased significantly), there are likely additional omitted variables—such as school funding, geographic location, or program types—that could further explain post-graduation earnings disparities. Additionally, this model assumes a linear relationship between predictors and earnings, which might oversimplify more complex, non-linear patterns in the data.


# Conclusion
The initial model, which excludes socioeconomic diversity, reveals significant disparities in post-graduation earnings across racial groups. The coefficients suggest that, holding other factors constant, schools with higher numbers of Black and Hispanic students are associated with lower mean earnings, while schools with more Asian students show a strong positive association with earnings. Notably, the p-values for these coefficients indicate statistical significance, reinforcing that these disparities are unlikely to be due to random chance.

However, the relatively low R-squared value (0.14) in this model suggests that racial composition alone explains only a small portion of the variability in average earnings. This highlights that while racial disparities exist, other unobserved factors—such as socioeconomic diversity, school resources, or geographic differences—are likely influencing post-graduation outcomes. The negative coefficients for Black and Hispanic student numbers underscore systemic inequalities that may be linked to broader social and institutional challenges, which are not accounted for in this model.

The results of the second model demonstrate that socioeconomic diversity plays a crucial role in explaining variations in post-graduation earnings, significantly improving the model’s explanatory power when included. Its addition, however, highlights the challenge of multicollinearity and the redistribution of explanatory influence among variables, particularly racial composition. While the model provides valuable insights, further refinements—including additional variables and consideration of non-linear relationships—are necessary to fully capture the determinants of earnings disparities across different demographics.







[](images/NCES.png)

## A Second Analysis: What does the SAT really test?
The data is sourced from the National Center of Education Statistics (NCES). It summarizes data from more than 25 surveys administered by NCES and other government agencies. The primary responsibility of Annual Reports is to produce the congressionally mandated *Condition of Education* to display data about various levels of education and labor force outcomes in the United States. It provides easy access to an array of education statistics, informing national policy-making decisions, the news media, and the general public.

*The dataset can be accessed using the following [link](https://nces.ed.gov/surveys/annualreports/).*

## Background and Purpose





