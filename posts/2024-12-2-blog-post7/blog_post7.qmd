---
title: "Blog post7"
subtitle: ""
author: "group 3"
date: "2024-12-2"
description: "Thesis: The relationship between the popularity of different majors and employment outcomes"
image-alt: ""
categories: []
date-modified: "2024-12-9"
draft: false
---

```{r}
library(tidyverse)
library(dplyr)
library(ggplot2)
```

```{r}
education_cohort_combined_data1 <- read_rds("dataset/education_cohort_combined_data.rds")

education_cohort_combined_data1 <- education_cohort_combined_data1 |>
  mutate(
    EARN_MDN_5YR = as.numeric(EARN_MDN_5YR)
  ) |>
  select(
    'EARN_MDN_5YR',
    'INSTNM',
    'EARN_COUNT_WNE_5YR',
    'CIPDESC',
    'CREDDESC',
    'ZIP',
    starts_with('PCT_')
  )


field_summary <- education_cohort_combined_data1 |>
  group_by(CIPDESC) |>
  summarise(
    Avg_Earning_5YR = mean(EARN_MDN_5YR, na.rm = TRUE),
    Total_Earning_5YR = sum(EARN_MDN_5YR, na.rm = TRUE),
    Count = n()
  ) |>
  arrange(desc(Total_Earning_5YR))
```

```{r}
Institution_summary <- education_cohort_combined_data1 |>
  group_by(INSTNM) |>
  summarise(
    Avg_Earning_5YR = mean(EARN_MDN_5YR, na.rm = TRUE),
    Total_Earning_5YR = sum(EARN_MDN_5YR, na.rm = TRUE),
    Count = n()
  ) |>
  arrange(desc(Total_Earning_5YR)) |>
  arrange(desc(Avg_Earning_5YR))
```

```{r}
# Total earnings of different fields of study ranking
top_fields <- field_summary |>
  top_n(30, Total_Earning_5YR)
#Listing the fields of study with the highest employment outcomes in a descending order
ggplot(top_fields, aes(x = reorder(CIPDESC, -Total_Earning_5YR), y = Total_Earning_5YR)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  labs(title = "Top Fields of Study Total Earnings", x = "Field of Study", y = "Total Earnings)")
```

```{r}
# Average earnings of different fields of study ranking
top_fields2 <- field_summary |>
  top_n(30, Avg_Earning_5YR)
#Listing the fields of study with the highest employment outcomes in a descending order
ggplot(top_fields2, aes(x = reorder(CIPDESC, -Avg_Earning_5YR), y = Avg_Earning_5YR)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  labs(title = "Top Fields of Study Average Earnings", x = "Field of Study", y = "Average Earnings)")
```

```{r}
# Bar chart for top institutions in Massachusetts
top_institutions <- Institution_summary %>%
  top_n(10, Avg_Earning_5YR)

ggplot(top_institutions, aes(x = reorder(INSTNM, -Avg_Earning_5YR), y = Avg_Earning_5YR)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  labs(title = "Top Institutions by Employment Outcomes", x = "Institution", y = "Average Earning (5 Years After Completion)")
```

```{r}
# Convert PCT_RACE to numeric
education_cohort_combined_data1$PCT_WHITE <- as.numeric(education_cohort_combined_data1$PCT_WHITE)
education_cohort_combined_data1$PCT_BLACK <- as.numeric(education_cohort_combined_data1$PCT_BLACK)
education_cohort_combined_data1$PCT_ASIAN <- as.numeric(education_cohort_combined_data1$PCT_ASIAN)
education_cohort_combined_data1$PCT_HISPANIC <- as.numeric(education_cohort_combined_data1$PCT_HISPANIC)

# Check if columns used in weighted.mean are numeric
str(education_cohort_combined_data1$PCT_WHITE)  # Should be numeric
str(education_cohort_combined_data1$EARN_COUNT_WNE_5YR)  # Should be numeric
```

```{r}
education_cohort_combined_data1 <- education_cohort_combined_data1 |>
  mutate(
    EARN_COUNT_WNE_5YR = as.numeric(EARN_COUNT_WNE_5YR)  # Convert to numeric
  )
```

```{r}
# Remove rows with NA in key columns
education_cohort_combined_data1 <- education_cohort_combined_data1 |>
  filter(!is.na(EARN_MDN_5YR) & !is.na(PCT_WHITE) & !is.na(PCT_BLACK))

field_race_summary <- education_cohort_combined_data1 |>
  group_by(CIPDESC) |>
  summarise(
    Avg_White = weighted.mean(PCT_WHITE, EARN_COUNT_WNE_5YR, na.rm = TRUE),
    Avg_Black = weighted.mean(PCT_BLACK, EARN_COUNT_WNE_5YR, na.rm = TRUE),
    Avg_Hispanic = weighted.mean(PCT_HISPANIC, EARN_COUNT_WNE_5YR, na.rm = TRUE),
    Avg_Asian = weighted.mean(PCT_ASIAN, EARN_COUNT_WNE_5YR, na.rm = TRUE),
    Avg_Earnings = mean(EARN_MDN_5YR, na.rm = TRUE)
  ) |>
  arrange(desc(Avg_Earnings))

field_race_summary
```